# Compte-rendu du TP7 de ARCHI2

__Question B1 :__

Le controleur DMA possède 5 registres adressables :
- __SOURCE__ accessible en lecture/ecriture. Une écriture dans ce registre permet de définir l'adresse de base du buffer source lors d'un  transfert. Si l'automate de la DMA n'est pas en mode IDLE, l'écriture dans le registre est ignoré.
- __DEST__ accessible en lecture/ecriture. Une écriture dans ce registre permet de définir l'adresse de base du buffer destination lors d'un transfert. Si l'automate de la DMA n'est pas en mode IDLE, l'écriture dans le registre est ignoré.
- __LENGHT/STATUS__ accessible en lecture/écriture. Une écriture dans ce registre démarre le transfert DMA avec les adresses contenues dans les deux registres précédents et de définir la longeur du ce qu'il faut transferer en nombre d'octets).
- __RESET__ accessible seulement en écriture. L'écrirture dans le registre RESET arrête le transfert en cours et force le passage de la FSM maître à l'état IDLE.
- __IRQ_DISABLED__ accessible en lecture/écriture. Désactive l'interruption si le registre contient la valeur zéro.

__Question B2 :__

L'argument _burst_ représente le nombre maximum de mots par rafale d'écriture lors d'un stransfert.

__Question B3 :__

Ce composant nécessite deux automates car il se comporte à la fois comme un maitre et comme une cible. De plus, il est censé s'exécuter en parralelle avec le processeur et doit donc remplir aussi en parallele son rôle de maitre et d'esclave d'où les deux FSM.

__Question B4 :__

La bascule r\\\_stop permet d'arrèter le transfert en cours si demandé. Si r\\\_stop = false alors on continue le transfert sinon on arrête le transfert, la FSM de la DMA retourne à l'état IDLE.

__Question B5 :__

## Architecture matérielle

__Question C1 :__

La longueur par défaut d'une rafale est de 16 mots. L'avantage d'utiliser des grosses rafales est de transférer plusieurs mots en une seule transaction et donc d'améliorer le nombre de cycle par mot transféré.

Le problème de ce choix est que le bus est donc plus longtemps sollicité lors d'un transfert. 

__Question C2 :__


Le segment de base de la DMA est à l'adresse 0x93000000. Son numéro de cible est 6. Son numéro de maître correspond au nombre processeur sur la machine. 
La ligne d'interruption IRQ controller par la DMA est connecté sur le port d'entré 0 du composant ICU.

## Application logicielle

__Question D1 :__

Les données des pixels de l'image sont copiées depuis le tampon (buffer) mémoire vers le frame buffer, c'est donc le processeur qui effectue le transfert en copiant les données du tampon vers le frame buffer.

Cette fonction est bloquante car c'est une fonction synchrone.

__Question D2 :__

La durée de construction d'une image est d'environ 3 Million de cycles. La durée d'affichage est de 496 500 cycles.

__Question D3 :__

La différence entre l'appel système `fb_sync_write()` et `fb_write()` est que le transfert n'est pas réalisé par le même matériel (processeur pour `fb_sync_write()` et le coprocesseur DMA pour `fb_write()`) mais ces deux fonctions réalisent le transfert de donées depuis un buffer tampon côté utilisateur vers le frame buffer coté kernel. De plus, l'appel système `fb_sync_write()` est synchrone contrairement à l'autre.

L'appel système `fb_completed()` est une fonction non bloquante qui prévient lorsque le transfert est terminé.

__Question D4 :__

La durée d'affichage d'une image avec la DMA est d'environ 2,9 Million de cycles après modification.

__Question D5 :__

 

